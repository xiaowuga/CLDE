# RenderingGlass æ¸²æŸ“ç»“æœå¯¼å‡ºåŠŸèƒ½ - å®ç°æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ä»£ç ä¿®æ”¹

#### ä¿®æ”¹çš„æ–‡ä»¶ï¼š

**1. `/workspace/app/src/main/cpp/RenderingGlass/RenderClient.h`**
- æ·»åŠ äº†å…¬å…±æ–¹æ³•ï¼š
  - `bool exportRenderResult(const std::string& outputPath)` - å¯¼å‡ºå•å¸§æ¸²æŸ“ç»“æœ
  - `void enableAutoExport(bool enable, int intervalFrames = 30)` - å¯ç”¨è‡ªåŠ¨å¯¼å‡º
  
- æ·»åŠ äº†ç§æœ‰æˆå‘˜å˜é‡ï¼š
  - `bool autoExportEnabled` - è‡ªåŠ¨å¯¼å‡ºå¼€å…³
  - `int exportInterval` - å¯¼å‡ºé—´éš”å¸§æ•°
  - `int framesSinceLastExport` - è‡ªä¸Šæ¬¡å¯¼å‡ºä»¥æ¥çš„å¸§æ•°

**2. `/workspace/app/src/main/cpp/RenderingGlass/RenderClient.cpp`**
- å®ç°äº† `exportRenderResult()` æ–¹æ³•ï¼š
  * å®Œæ•´çš„å‚æ•°éªŒè¯ï¼ˆè·¯å¾„ã€åˆ†è¾¨ç‡æ£€æŸ¥ï¼‰
  * ä½¿ç”¨ `glReadPixels` è¯»å–å¸§ç¼“å†²åŒº
  * å›¾åƒå‚ç›´ç¿»è½¬ï¼ˆOpenGLåæ ‡ç³»è½¬å›¾åƒåæ ‡ç³»ï¼‰
  * RGBAåˆ°BGRé¢œè‰²æ ¼å¼è½¬æ¢
  * ä½¿ç”¨ `cv::imwrite` ä¿å­˜å›¾åƒ
  * å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
  
- å®ç°äº† `enableAutoExport()` æ–¹æ³•ï¼š
  * è®¾ç½®è‡ªåŠ¨å¯¼å‡ºå‚æ•°
  * é‡ç½®å¸§è®¡æ•°å™¨
  
- åœ¨ `Update()` æ–¹æ³•ä¸­æ·»åŠ äº†è‡ªåŠ¨å¯¼å‡ºé€»è¾‘ï¼š
  * å¸§è®¡æ•°å’Œé—´éš”æ£€æŸ¥
  * è‡ªåŠ¨ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å
  * å®šæœŸè§¦å‘å¯¼å‡º

### 2. æ–‡æ¡£åˆ›å»º

åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£ç³»ç»Ÿï¼š

1. **`EXPORT_RENDERING_GUIDE.md`** (è¯¦ç»†æŒ‡å—)
   - åŠŸèƒ½æ¦‚è¿°
   - APIå‚è€ƒ
   - æŠ€æœ¯ç»†èŠ‚
   - ä½¿ç”¨ç¤ºä¾‹
   - æ•…éšœæ’æŸ¥
   - é«˜çº§ç”¨æ³•

2. **`USAGE_EXAMPLE.md`** (å¿«é€Ÿä½¿ç”¨)
   - å¿«é€Ÿå¼€å§‹
   - å®é™…åº”ç”¨åœºæ™¯
   - å¸¸è§é—®é¢˜
   - éªŒè¯æ–¹æ³•

3. **`RENDER_EXPORT_README.md`** (æ€»è§ˆæ–‡æ¡£)
   - åŠŸèƒ½ç®€ä»‹
   - æ ¸å¿ƒåŠŸèƒ½è¯´æ˜
   - æŠ€æœ¯å®ç°
   - æ€§èƒ½è€ƒè™‘
   - ä¾èµ–é¡¹

4. **`å¯¼å‡ºåŠŸèƒ½å®ç°æ€»ç»“.md`** (æœ¬æ–‡æ¡£)
   - å®ç°æ€»ç»“
   - ä½¿ç”¨è¯´æ˜

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### åŠŸèƒ½1ï¼šæ‰‹åŠ¨å¯¼å‡º

```cpp
// å¯¼å‡ºå½“å‰æ¸²æŸ“ç»“æœåˆ°æŒ‡å®šè·¯å¾„
bool success = Rendering->exportRenderResult("/storage/emulated/0/Download/screenshot.png");
```

### åŠŸèƒ½2ï¼šè‡ªåŠ¨å®šæœŸå¯¼å‡º

```cpp
// å¯ç”¨è‡ªåŠ¨å¯¼å‡ºï¼Œæ¯30å¸§å¯¼å‡ºä¸€æ¬¡
Rendering->enableAutoExport(true, 30);
```

## ğŸ“ å¦‚ä½•ä½¿ç”¨

### æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼

åœ¨ `scene_AppVer2.cpp` çš„ `initialize()` æ–¹æ³•ä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼š

```cpp
virtual bool initialize(const XrInstance instance, const XrSession session){
    _eng = construct_engine();
    
    std::string dataDir = _eng->appData->dataDir;
    Rendering = createModule<RenderClient>("RenderClient");
    
    auto frameData = _eng->frameData;
    Rendering->Init(*_eng->appData.get(), *_eng->sceneData.get(), frameData);
    
    // â˜…â˜…â˜… æ·»åŠ è¿™ä¸€è¡Œ â˜…â˜…â˜…
    Rendering->enableAutoExport(true, 30);  // æ¯30å¸§è‡ªåŠ¨å¯¼å‡ºä¸€æ¬¡
    
    _eng->start();
    
    return true;
}
```

è¿è¡Œåº”ç”¨åï¼Œæ¸²æŸ“ç»“æœä¼šè‡ªåŠ¨ä¿å­˜åˆ°ï¼š
- è·¯å¾„ï¼š`/storage/emulated/0/Download/`
- æ–‡ä»¶åï¼š`render_[æ—¶é—´æˆ³].png`
- é—´éš”ï¼šæ¯30å¸§ä¸€æ¬¡

### æ‰‹åŠ¨è§¦å‘å¯¼å‡º

åœ¨ä»»ä½•å¯ä»¥è®¿é—® `Rendering` å¯¹è±¡çš„åœ°æ–¹ï¼š

```cpp
// å¯¼å‡ºå½“å‰å¸§
Rendering->exportRenderResult("/storage/emulated/0/Download/my_screenshot.png");
```

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### å›¾åƒè§„æ ¼
- **åˆ†è¾¨ç‡**: 1920 x 1080
- **æ ¼å¼**: PNGï¼ˆé»˜è®¤ï¼‰ï¼Œä¹Ÿæ”¯æŒ JPGã€BMP
- **é¢œè‰²**: BGR 24ä½
- **åæ ‡**: è‡ªåŠ¨å¤„ç†OpenGLåæ ‡ç³»è½¬æ¢

### é”™è¯¯å¤„ç†
- âœ… å‚æ•°éªŒè¯ï¼ˆè·¯å¾„ã€åˆ†è¾¨ç‡ï¼‰
- âœ… OpenGLé”™è¯¯æ£€æŸ¥
- âœ… OpenCVæ“ä½œéªŒè¯
- âœ… å¼‚å¸¸æ•è·
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `std::vector` ç®¡ç†å†…å­˜
- æ”¯æŒè‡ªå®šä¹‰å¯¼å‡ºé—´éš”
- å®Œæ•´çš„é”™è¯¯æ¢å¤æœºåˆ¶

## ğŸ“Š æµ‹è¯•éªŒè¯

### æŸ¥çœ‹æ—¥å¿—
```bash
adb logcat | grep RenderClient
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
å¼€å§‹å¯¼å‡ºæ¸²æŸ“ç»“æœåˆ°: /storage/emulated/0/Download/render_1234567890.png
æ¸²æŸ“ç»“æœå¯¼å‡ºæˆåŠŸ: /storage/emulated/0/Download/render_1234567890.png (åˆ†è¾¨ç‡: 1920x1080)
```

### æŸ¥çœ‹å¯¼å‡ºçš„æ–‡ä»¶
```bash
adb shell ls -lh /storage/emulated/0/Download/render_*.png
```

### æ‹‰å–æ–‡ä»¶åˆ°ç”µè„‘
```bash
adb pull /storage/emulated/0/Download/render_*.png ./
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å­˜å‚¨æƒé™**: ç¡®ä¿åº”ç”¨æœ‰ `WRITE_EXTERNAL_STORAGE` æƒé™
2. **æ¸²æŸ“æ—¶æœº**: åœ¨æ¸²æŸ“å®Œæˆåè°ƒç”¨å¯¼å‡ºå‡½æ•°
3. **æ€§èƒ½å½±å“**: `glReadPixels` ä¼šé˜»å¡GPUï¼Œå»ºè®®ä¸è¦æ¯å¸§éƒ½å¯¼å‡º
4. **å­˜å‚¨ç©ºé—´**: æ¯å¼ PNGå›¾åƒçº¦2-5MBï¼Œæ³¨æ„ç£ç›˜ç©ºé—´
5. **è·¯å¾„æœ‰æ•ˆ**: ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨ä¸”å¯å†™

## ğŸš€ é«˜çº§åŠŸèƒ½

### æ›´æ”¹å¯¼å‡ºæ ¼å¼
```cpp
// JPGæ ¼å¼ï¼ˆæ–‡ä»¶æ›´å°ï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
Rendering->exportRenderResult("/path/to/output.jpg");

// BMPæ ¼å¼ï¼ˆæ— å‹ç¼©ï¼Œé€Ÿåº¦æœ€å¿«ï¼‰
Rendering->exportRenderResult("/path/to/output.bmp");
```

### è°ƒæ•´å¯¼å‡ºé¢‘ç‡
```cpp
// æ¯å¸§éƒ½å¯¼å‡ºï¼ˆä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼‰
Rendering->enableAutoExport(true, 1);

// æ¯60å¸§å¯¼å‡ºä¸€æ¬¡ï¼ˆçº¦2ç§’ï¼ŒFPS=30æ—¶ï¼‰
Rendering->enableAutoExport(true, 60);

// æ¯300å¸§å¯¼å‡ºä¸€æ¬¡ï¼ˆçº¦10ç§’ï¼ŒFPS=30æ—¶ï¼‰
Rendering->enableAutoExport(true, 300);
```

### ç¦ç”¨è‡ªåŠ¨å¯¼å‡º
```cpp
// å…³é—­è‡ªåŠ¨å¯¼å‡º
Rendering->enableAutoExport(false);
```

## ğŸ“¦ ä¾èµ–é¡¹

æœ¬åŠŸèƒ½ä½¿ç”¨çš„åº“ï¼ˆé¡¹ç›®ä¸­å·²å­˜åœ¨ï¼‰ï¼š

- **OpenGL ES**: `glReadPixels`
- **OpenCV**: `cv::imwrite`, `cv::flip`, `cv::cvtColor`
- **C++ STL**: `std::vector`, `std::chrono`

âœ… **æ— éœ€æ·»åŠ é¢å¤–ä¾èµ–**

## ğŸ‰ åŠŸèƒ½éªŒè¯

åŠŸèƒ½å·²å®Œæˆå¹¶é€šè¿‡ä»¥ä¸‹éªŒè¯ï¼š

- âœ… ä»£ç ç¼–è¯‘æ— é”™è¯¯
- âœ… æ— linterè­¦å‘Š
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… å®Œå–„çš„æ–‡æ¡£è¯´æ˜

## ğŸ“– ç›¸å…³æ–‡æ¡£

è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ï¼š

1. **å¿«é€Ÿå¼€å§‹**: `USAGE_EXAMPLE.md`
2. **è¯¦ç»†æŒ‡å—**: `EXPORT_RENDERING_GUIDE.md`
3. **æŠ€æœ¯æ–‡æ¡£**: `RENDER_EXPORT_README.md`

## ğŸ”— å¿«é€Ÿé“¾æ¥

### ä¸»è¦ä¿®æ”¹çš„ä»£ç ä½ç½®

**å¤´æ–‡ä»¶å£°æ˜**ï¼š
- `/workspace/app/src/main/cpp/RenderingGlass/RenderClient.h` (ç¬¬91-95è¡Œ)

**æ–¹æ³•å®ç°**ï¼š
- `/workspace/app/src/main/cpp/RenderingGlass/RenderClient.cpp` (ç¬¬261-333è¡Œ)

**è‡ªåŠ¨å¯¼å‡ºé€»è¾‘**ï¼š
- `/workspace/app/src/main/cpp/RenderingGlass/RenderClient.cpp` (ç¬¬203-216è¡Œ)

---

## æ€»ç»“

âœ¨ **RenderingGlass ç°åœ¨å¯ä»¥è½»æ¾å¯¼å‡ºæ¸²æŸ“ç»“æœäº†ï¼**

åªéœ€ä¸€è¡Œä»£ç å³å¯å¯ç”¨ï¼š
```cpp
Rendering->enableAutoExport(true, 30);
```

æˆ–éšæ—¶æ‰‹åŠ¨å¯¼å‡ºï¼š
```cpp
Rendering->exportRenderResult("/path/to/output.png");
```

ğŸ¯ **åŠŸèƒ½å®Œæ•´ã€æ–‡æ¡£é½å…¨ã€å³ç”¨å³èµ°ï¼**
